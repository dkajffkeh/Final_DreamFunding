<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="projectDetailMapper">
  
	<resultMap id="detailResultSet" type="Detail">
    	<result column="PROJECT_NO" property="projectNo"/>
    	<result column="MEMBER_NO" property="memberNo"/>
    	<result column="PRO_CATENO" property="proCategoryNo"/>
    	<result column="BANK_NO" property="bankNo"/>
    	<result column="PROJECT_GOAL" property="projectGoal"/>
    	<result column="PROJECT_TITLE" property="projectTitle"/>
    	<result column="PROJECT_SUBTITLE" property="projectSubtitle"/>
    	<result column="PROJECT_GPRICE" property="projectGoalPrice"/>
    	<result column="PROJECT_START_DT" property="projectStartDate"/>
    	<result column="PROJECT_CLOSE_DT" property="projectEndDate"/>
    	<result column="PROJECT_URL" property="projectURL"/>
    	<result column="PROJECT_THUMPATH" property="projectThumbnailPath"/>
    	<result column="PROJECT_FILENAME" property="projectFileName"/>
    	<result column="PROJECT_REASON" property="projectReason"/>
    	<result column="PROJECT_COUNT" property="projectCount"/>
    	<result column="PROJECT_CONTENT" property="projectContent"/>
    	<result column="PROJECT_VURL" property="projectVideoURL"/>
    	<result column="PROJECT_REFCON" property="projectRefundPolicy"/>
    	<result column="CREATOR_THUMPATH" property="creatorThumbnailPath"/>
    	<result column="CREATOR_PROFILE" property="creatorProfile"/>
    	<result column="CREATOR_NAME" property="creatorName"/>
    	<result column="CREATOR_INTRO" property="creatorIntro"/>
    	<result column="CREATOR_PHONE" property="creatorPhone"/>
    	<result column="PHONE_CHECK" property="phoneCheck"/>
    	<result column="CREATOR_EMAIL" property="creatorEmail"/>
    	<result column="CREATOR_BANK" property="creatorBank"/>
    	<result column="CREATOR_ACOUNT" property="creatorAccount"/>
    	<result column="CREATOR_ACHOLDER" property="accountHolder"/>
    	<result column="CREATOR_WEBURL" property="webURL"/>
    	<result column="CREATOR_INSTA" property="insta"/>
    	<result column="CREATOR_FACEBOOK" property="facebook"/>
    	<result column="CREATOR_STATUS" property="status"/>
    	<result column="HASHTAG" property="hashtag"/>
    	<result column="PROJECT_CRDATE" property="createDate"/>
    	<result column="PROJECT_TEMPORARY" property="projectTemp"/>
    	<result column="PRO_CATENAME" property="projectCategoryName"/>
 	</resultMap>

	<resultMap id="detailRewardResultSet" type="DetailReward">
  		<result column="RE_NO" property="rewardNo"/>
  		<result column="PROJECT_NO" property="projectNo"/>
  		<result column="RE_PRICE" property="rewardPrice"/>
  		<result column="RE_STATUS" property="rewardStatus"/>
  		<result column="RE_NUMBER" property="rewardNumber"/>
  		<result column="RE_SH_STATUS" property="rewardShCheck"/>
  		<result column="RE_SALECOUNT" property="saleCount"/>
  	</resultMap>
 	
 	
 	<resultMap id="detailRewardOptResultSet" type="DetailRewardOpt">
 		<result column="RE_OPTION_NO" property="optionNo"/>
		<result column="REWARD_NO" property="rewardNo"/>
		<result column="RE_OPTION_NAME" property="rewardContent"/>
 	</resultMap>
 	
 	<resultMap id="detailReportResultSet" type="DetailReport">
 		<result column="REPORT_NO" property="reportNo"/>
 		<result column="PROJECT_NO" property="projectNo"/>
 		<result column="PROJECT_TITLE" property="projectTitle"/>
 		<result column="MEMBER_NO" property="memberNo"/>
 		<result column="REPORT_CONTENT" property="reportContent"/>
 		<result column="REPORT_DATE" property="reportDate"/>
 		<result column="REPORT_STATUS" property="reportStatus"/>
 	</resultMap>
 	
  	<resultMap id="likeResultSet" type="Like">
 		<result column="PROJECT_NO" property="projectNo"/>
		<result column="MEMBER_NO" property="memberNo"/>
 	</resultMap>
  
 	
   <select id="selectListCount" resultType="_int">
   	SELECT 
   		   COUNT(*)
      FROM PROJECT
     WHERE CREATOR_STATUS = 'U' 		   
   </select>
  
   <select id="selectDetailList" resultMap="detailResultSet">
   	SELECT 
   		    PROJECT_NO
		  , P.PRO_CATENO
		  , PROJECT_TITLE
		  , PROJECT_GPRICE
		  , PROJECT_FILENAME
		  , CREATOR_NAME
		  , C.PRO_CATENAME
      FROM  PROJECT P
          , PRO_CATEGORY C 
     WHERE CREATOR_STATUS = 'U' 
       AND P.PRO_CATENO = C.PRO_CATENO
     ORDER
        BY PROJECT_NO DESC 		   
   </select>
  
  	<update id="increaseDetailCount" parameterType="_int">
  		UPDATE 
  			   PROJECT
  		   SET PROJECT_COUNT = PROJECT_COUNT+1
  		 WHERE CREATOR_STATUS = 'U'
  		   AND PROJECT_NO = #{ pno }
  	</update>
  
<!-- 프로젝트 디테일 상세조회  -->  
  	<select id="selectDetailAll" parameterType="_int" resultMap="detailResultSet">
  		   SELECT
	    	  	  PROJECT_NO
				, MEMBER_NO
				, P.PRO_CATENO
				, BANK_NO
				, PROJECT_GOAL
				, PROJECT_TITLE
				, PROJECT_SUBTITLE
				, PROJECT_GPRICE
				, PROJECT_START_DT
				, PROJECT_CLOSE_DT
				, PROJECT_URL
				, PROJECT_THUMPATH
				, PROJECT_FILENAME
				, PROJECT_CONTENT
				, PROJECT_VURL
				, PROJECT_REFCON
				, CREATOR_THUMPATH
				, CREATOR_PROFILE
				, CREATOR_NAME
				, CREATOR_INTRO
				, CREATOR_PHONE
				, PHONE_CHECK
				, CREATOR_EMAIL
				, CREATOR_BANK
				, CREATOR_ACOUNT
				, CREATOR_ACHOLDER
				, CREATOR_WEBURL
				, CREATOR_INSTA
				, CREATOR_FACEBOOK
				, HASHTAG
				, PROJECT_CRDATE
				, PROJECT_TEMPORARY
				, C.PRO_CATENAME
		     FROM PROJECT P
			    , PRO_CATEGORY C 
		    WHERE CREATOR_STATUS = 'U'
	   	      AND P.PRO_CATENO = C.PRO_CATENO
		      AND PROJECT_NO = #{ pno }
  	</select>
  	
<!-- 리워드 조회 쿼리 -->  	
  	<select id="selectDetailReward" parameterType="_int" resultMap="detailRewardResultSet">
 	SELECT *
  		  FROM REWARD
  	     WHERE PROJECT_NO = #{ pno }
 		 ORDER
 		    BY RE_NO
  	</select>
  	
  	<select id="selectDetailRewardOpt" parameterType="_int" resultMap="detailRewardOptResultSet">
 	SELECT *
  		  FROM RE_OPTION
  	     WHERE REWARD_NO = #{ rno } 
  	</select>
  	
<!-- 프로젝트 신고 등록 쿼리 -->  	
	<insert id="insertReport" parameterType="DetailReport">
  		INSERT 
  		  INTO REPORT
	  		  (
	  		  	  REPORT_NO
	  		  	, PROJECT_NO
	  		  	, MEMBER_NO
	  		  	, REPORT_CONTENT
	  		  	, REPORT_DATE
	  		  	, REPORT_STATUS
	  		  )
  		VALUES (
  				  SEQ_RPNO.NEXTVAL	
  				, #{ projectNo }
  				, #{ memberNo }
  				, #{ reportContent }
  				, SYSDATE
  				, 'P'
  			   )  
  	</insert>
  	
<!-- 좋아요 생성 쿼리 --> 
<insert id="insertDetailLike" parameterType="Like">
	INSERT
	  INTO LIKEY
	      (
	          PROJECT_NO
	        , MEMBER_NO
	      )
    VALUES (
    		   #{projectNo}
    		 , #{memberNo}
    		)
</insert> 	

<!-- 좋아요 삭제 쿼리 -->
<delete id="deleteDetailLike" parameterType="Like">
	DELETE 
	  FROM LIKEY
	 WHERE PROJECT_NO = #{projectNo}
	   AND MEMBER_NO = #{memberNo}
</delete>
 	
<!-- 좋아요 조회 쿼리 -->
<select id="selectDetailLike" parameterType="Like" resultType="_int">
	SELECT COUNT(*)
	  FROM LIKEY
	 WHERE PROJECT_NO = #{projectNo}
   	   AND MEMBER_NO = #{memberNo}  
</select>

 	
</mapper>
